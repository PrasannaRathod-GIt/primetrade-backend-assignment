<!doctype html>
<html>
<head><meta charset="utf-8"><title>Login — PrimeTrade</title><link rel="stylesheet" href="styles.css"></head>
<body>
<header>
  <div><strong>PrimeTrade</strong></div>
  <nav>
    <a href="register.html">Register</a>
    <a href="login.html">Login</a>
    <a href="dashboard.html">Dashboard</a>
  </nav>
</header>

<main>
  <h2>Login</h2>
  <form id="loginForm">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Password" required />
    <button type="submit" id="submitBtn">Login</button>
    <div id="busy" class="small hidden">Signing in…</div>
  </form>

  <div id="msg" class="msg hidden"></div>
</main>

<script>
const BASE_URL = 'http://127.0.0.1:8000';
const LOGIN_PATH = '/api/v1/auth/token';
const form = document.getElementById('loginForm');
const msgEl = document.getElementById('msg');
const busy = document.getElementById('busy');
const submitBtn = document.getElementById('submitBtn');

function showMsg(text, t='error'){ msgEl.innerText=text; msgEl.className='msg '+(t==='error'?'error':'success'); msgEl.classList.remove('hidden'); }
function clearMsg(){ msgEl.className='msg hidden'; msgEl.innerText=''; }

form.addEventListener('submit', async (e) => {
  e.preventDefault(); clearMsg();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  if (!email || !password) { showMsg('Email and password required.'); return; }

  submitBtn.disabled = true; busy.classList.remove('hidden');
  try {
    const formData = new URLSearchParams();
    formData.append('username', email);
    formData.append('password', password);

    const res = await fetch(BASE_URL + LOGIN_PATH, {
      method: 'POST',
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      body: formData.toString()
    });
    const data = await res.json().catch(()=>null);
    if (!res.ok) {
      showMsg(data?.detail || JSON.stringify(data) || 'Login failed','error');
      return;
    }
    localStorage.setItem('token', data.access_token);
    showMsg('Logged in — redirecting...', 'success');
    setTimeout(()=> location.href='dashboard.html', 600);
  } catch(err) { showMsg('Network error: '+err,'error'); }
  finally { submitBtn.disabled = false; busy.classList.add('hidden'); }
});
</script>
</body>
</html>
